<ion-header>
	<ion-toolbar>
		<ion-title>{{ 'tax.EDIT' | translate }}</ion-title>
		<ion-buttons slot="start">
			<ion-back-button
				defaultHref="/trips"
				[text]="'menu.BACK' | translate"
			></ion-back-button>
		</ion-buttons>
		<ion-buttons slot="end">
			<ion-button
				type="submit"
				(click)="taxFormElement.ngSubmit.emit()"
				[disabled]="taxForm.invalid"
				><ion-icon slot="icon-only" name="checkmark-outline"></ion-icon
			></ion-button>
		</ion-buttons>
	</ion-toolbar>
</ion-header>

<ion-content class="tax-content">
	<form
		[formGroup]="taxForm"
		(ngSubmit)="doEditTaxDeclaration()"
		#taxFormElement="ngForm"
	>
		<ion-list class="inputs-list" lines="full" *ngIf="!isLoading">
			<ion-grid>
				<ion-row>
					<ion-col size="12">
						<ion-label class="input-label"
							>{{ 'tax.CASH' | translate }}</ion-label
						>
					</ion-col>
					<ion-col>
						<ion-item class="input-item">
							<ion-label position="floating"
								>{{ 'fields.TOTAL' | translate }}</ion-label
							>
							<ion-input
								type="number"
								formControlName="cash"
								clearInput
								autocapitalize="off"
								inputmode="decimal"
							>
							</ion-input>
						</ion-item>
					</ion-col>
				</ion-row>
			</ion-grid>
			<div formGroupName="details">
				<ion-grid>
					<div
						*ngFor="let detail of taxDetailKeys; index as i"
						[formGroupName]="detail"
					>
						<ion-row>
							<ion-col size="12">
								<ion-label class="input-label"
									>{{ 'tax.TAX_OPTION.' + detail | translate
									}}</ion-label
								>
							</ion-col>
							<ion-col size="6">
								<ion-item class="input-item">
									<ion-label position="floating"
										>{{ 'fields.QUANTITY' | translate
										}}</ion-label
									>
									<ion-input
										type="number"
										formControlName="quantity"
										clearInput
										autocapitalize="off"
										inputmode="numeric"
										(keypress)="noDecimals($event)"
									>
									</ion-input>
								</ion-item>
							</ion-col>
							<ion-col size="6">
								<ion-item class="input-item">
									<ion-label position="floating"
										>{{ 'fields.PRICE' | translate
										}}</ion-label
									>
									<ion-input
										type="number"
										formControlName="price"
										clearInput
										autocapitalize="off"
										inputmode="decimal"
									>
									</ion-input>
								</ion-item>
							</ion-col>
						</ion-row>
						<div class="error-container">
							<ng-container
								*ngFor="let validation of validation_messages[detail]"
							>
								<div
									class="error-message"
									*ngIf="taxForm.get('details').get(detail).hasError(validation.type) && (taxForm.get('details').get(detail).dirty || taxForm.get('details').get(detail).touched)"
								>
									<ion-icon
										name="information-circle-outline"
									></ion-icon>
									<span>{{ validation.message }}</span>
								</div>
							</ng-container>
						</div>
					</div>
				</ion-grid>
			</div>
		</ion-list>
	</form>
</ion-content>
